http://www.pentest-standard.org/index.php/Exploitation


内容
1 目的
2 对策
2.1 反病毒
2.1.1 编码
2.1.2 包装
2.1.3 加密
2.1.4 白名单旁路
2.1.5 工艺注射
2.1.6 纯粹的记忆驻留
2.2 人类
2.3 数据执行预防（DEP）
2.4 地址空间布局随机化
2.5 Web应用防火墙（WAF）
3 逃避
4 精确打击
5 定制开发大道
6 量身定制的漏洞利用
6.1 利用自定义
7 零日角度
7.1 模糊测试
7.2 源代码分析
7.3 漏洞利用的类型
7.3.1 缓冲区溢出
7.3.2 SEH覆盖
7.3.3 面向返回的编程
7.4 流量分析
7.5 物理访问
7.5.1 人的角度
7.5.2 PC访问
7.6 接近访问（WiFi）
7.6.1 WiFi攻击
7.6.2 攻击用户
8 示例攻击途径
9 总体目标
目的
渗透测试的开发阶段仅侧重于通过绕过安全限制来建立对系统或资源的访问。如果前一阶段，漏洞分析正确执行，则应对此阶段进行精心策划并进行精确打击。主要重点是确定组织的主要切入点并确定高价值目标资产。
如果漏洞分析阶段已正确完成，则应符合高值目标列表。最终，攻击向量应考虑到成功概率和对组织的最大影响。
对策
对策被定义为阻碍成功完成利用途径的能力的预防性技术或控制。该技术可以是基于主机的入侵防御系统，安全防护，Web应用程序防火墙或其他预防方法。在执行漏洞利用时，应考虑几个因素。如果采用预防性技术，则应考虑采用规避技术。在无法实现这一目标的情况下，应考虑其他利用方法。
总的来说，目的是在攻击组织时保持隐身，如果警报被绊倒，评估的水平可能会降低。如果可能的话，应该在触发漏洞利用之前列举对策。这可以通过干式攻击或枚举技术来完成。
反病毒
防病毒是一种旨在防止恶意软件部署在系统上的技术。作为渗透测试人员，我们应该能够识别这些类型的反病毒技术，并能够防范它们。防病毒是可以采用的所有不同预防措施的一小部分，例如基于主机的入侵防御系统，Web应用防火墙和其他预防性技术。
编码
编码是以使得部署的代码看起来不相同的方式混淆数据的方法。通过编码，混淆通常通过加扰信息和重新排列来发生，以隐藏应用程序实际执行的操作。
填料
打包在某种意义上类似于编码，因为它试图重新排列数据以压缩应用程序或“打包”它。这样做的希望是，正在传递的可执行文件或代码片段将以防病毒技术无法获取的方式进行模糊处理。
加密
加密，如编码和打包是另一种操纵预期可运行代码的方法，使其无法识别或可供检查。只有在内存中解密后（使用类似于打包的方法），实际代码才会首次暴露 - 希望在安全机制允许它通过后，它会在解密后立即执行。
白名单旁路
白名单技术利用可信模型，一次性在给定系统上看到的应用程序。该技术采用系统的基线，并确定在系统上运行的正常情况与外来的情况。渗透测试人员应该能够绕过白名单技术。最常见的方法之一是通过直接内存访问。白名单不具备实时监视内存的能力，如果内存驻留程序正在运行且未接触磁盘，则它可以在不被给定技术检测的情况下运行。
工艺注射
流程注入只是注入已经运行的流程的方法。通过注入到进程中，应用程序的信息可以隐藏在通常本质上可信的进程中。预防性测量技术很难检查运行过程，并且几乎总是隐藏在应用程序认为是可信赖的不同过程中。
纯粹记忆居民
内存驻留攻击通常是最优选的，因为大多数技术不检查内存。作为攻击者，找到一种纯粹生活在记忆中的方式是最理想的。写入磁盘时，大多数应用程序将对可能的maliicous软件进行扫描，基线和其他标识。写入磁盘时检测到的能力变得非常大。
人的
在进行利用时，并不总是通过直接利用或通过应用程序缺陷的最佳途径。有时，人为因素可能是攻击组织的更好方式。了解正确的攻击途径非常重要，并确保我们利用的方法是最佳途径。
数据执行预防（DEP）
在进行剥削时，许多预防措施都可以发挥作用。数据执行保护是在大多数操作系统中实施的防御措施，并在内存中发生覆盖时阻止执行权限。DEP背后的思考过程是阻止攻击者重写内存然后执行该代码。有多种方法可以绕过数据执行预防，稍后将在PTES的开发阶段进行讨论。
地址空间布局随机化
在缓冲区溢出漏洞（或我们控制内存的任何内容）中，内存地址是硬编码的，以便将重定向执行流程重定向到我们的shellcode。在ASLR的情况下，某些字节是随机的，以防止攻击者预测他/她总是去哪里以执行shellcode。
Web应用程序防火墙（WAF）
Web应用程序防火墙是一种与应用程序内联的技术，以防止基于Web的应用程序攻击。Web应用程序防火墙尝试识别针对给定Web应用程序的潜在危险或恶意攻击并阻止它们。Web应用程序防火墙有许多旁路技术，应在渗透测试期间进行测试。
闪避
逃避是用于在穿透测试期间逃避检测的技术。这可能是为了避开摄像机系统而导致警卫无法看到，混淆您的有效负载以逃避入侵检测系统（IDS）或入侵防御系统（IPS）或编码请求/响应以绕过Web应用防火墙。总体而言，在利用漏洞之前，应制定确定逃避技术或人员的低风险情景的必要性。
精确打击
渗透测试的主要焦点是模拟攻击者以表示针对组织的模拟攻击。通过渗透测试带来的价值通常不是通过粉碎和抓取技术，其中攻击本质上是嘈杂的并且试图尝试每次攻击。这种方法在渗透测试结束时可能特别有用，可以衡量组织的事件响应水平，但在大多数情况下，开发阶段是对目标的特定研究的积累。
定制开发大道
每次攻击通常与开发途径的发生方式不同。为了在此阶段取得成功，应根据方案定制和定制攻击。例如，如果发生无线穿透测试，并且正在使用特定技术，则需要根据所采用的技术来识别和攻击这些技术。清楚地了解每个场景和漏洞利用的适用性是渗透测试这一阶段最重要的方面之一。
量身定制的漏洞利用
在许多情况下，互联网上公开的漏洞利用可能需要一些工作才能顺利完成。在大多数情况下，如果漏洞是针对Windows XP SP2设计的，则需要对漏洞进行特定修改才能使攻击通过Windows XP SP3成功。渗透测试人员应具备适当的知识，以便能够定制漏洞利用程序以及动态更改以成功完成攻击的能力。
利用自定义
在发生攻击时，通常需要模拟受害者基础设施，以确保开发阶段成功。在信息收集阶段利用的技术总是可以帮助实现这一点，但是，拥有一个有效的基础设施和系统将使说明阶段变得更加容易。在定制漏洞利用的情况下，渗透测试人员应该能够定制已经公开的攻击以成功攻击系统。漏洞利用的一个共同主题是针对特定版本的操作系统或应用程序。其原因是由于存储器地址基于服务包和/或操作系统的新版本而改变。
零日角度
在大多数情况下，零日角度通常是大多数渗透测试仪的最后手段。这种类型的攻击通常代表一个非常先进的组织，可以通过正常的攻击方法处理针对组织的集中攻击。在某些情况下，可能会进行研究，以便对尚未发现的漏洞进行逆向工程，模糊测试或执行高级发现。如果此类攻击适用，请确保再现最佳攻击者知识的环境以包括对策技术。
为了使零日攻击成功（或任何利用此漏洞），拥有相同的操作系统，补丁和对策对于成功非常重要。有时，根据已发生的访问或枚举级别，可能无法提供此信息。
起毛
模糊测试是指重新创建协议或应用程序并尝试在应用程序中发送数据以识别漏洞的能力。通常情况下，模糊器的希望是识别应用程序中的崩溃并从中制作特定的漏洞。在模糊测试的情况下，攻击者试图从之前未发现的内容中创建特定的漏洞。作为渗透测试的一部分，如果在参与期间没有确定途径，或者参与需要零日研究; 应该利用模糊测试技术来识别潜在的脆弱暴露。
源代码分析
渗透测试程序可用的其他途径是源代码是可用的还是开源的。如果测试人员能够查看源代码并识别应用程序中的缺陷，那么也可以通过这些方法识别零日暴露。
漏洞利用的类型
在渗透测试期间可以识别出几种类型的漏洞，可以归类为零日。其中一些列在本节中。
缓冲区溢出
由于编码技术不当，会发生缓冲区溢出。具体而言，这通常发生在程序将数据写入缓冲区然后超出缓冲区边界并开始覆盖部分内存时。在缓冲区溢出攻击中，攻击者的目标是控制崩溃并获得给定系统上的代码执行。在缓冲区溢出漏洞利用中，一种比较常见的技术是覆盖给定的寄存器并“跳转”到shellcode。
SEH覆盖
当结构化异常处理程序开始正常关闭应用程序时，会发生SEH覆盖。攻击者可以操纵SEH的工作方式，覆盖SEH处理程序的基地址，并通过SEH获得对执行流程的控制。这是一个利用缓冲区溢出漏洞的常见攻击和已经符合SEH的应用程序。
面向回归的编程
面向返回编程（ROP）是在用户控制执行流程的部分期间使用的技术，但是可以存在数据执行预防（DEP）或其他排除防御机制。在启用DEP的情况下，攻击者无法直接访问执行特定的程序集指令，因此攻击者构建ROP小工具以准备某些Windows API调用或技术来禁用DEP或绕过DEP。一种常见的方法是利用WriteProcessMemory调用将数据从堆栈复制到可写的内存空间中，然后可以执行该内存空间。
流量分析
流量分析是识别正在发送什么类型的信息以及理解和操纵该流量的能力的技术。渗透测试人员应该能够理解协议如何工作以及如何操纵它以利用攻击。
物理访问
在渗透测试期间的物理访问可以是试图绕过物理安全控制并获得未授权访问的可行攻击方法。在渗透测试期间，评估员应该能够识别可能存在缺陷的物理安全控制措施，并在范围内尝试访问设施。
人的角度
在物理渗透测试期间，一些最明显的方法是社交工程师进入设施并获得访问权限。这需要有关组织如何开展业务的重要知识，以及您从情报收集阶段学到的所有知识。
PC访问
如果授予PC物理访问权限，则渗透测试人员应该能够攻击PC并通过允许访问系统的多种方法获得访问权限。
近距离接入（WiFi）
无线通信是攻击通过RF类型通信获得访问的途径。渗透测试仪应查看FCC无线电频率列表，以查看目标是否已注册使用的频谱频率。
WiFi攻击
无论协议如何，WEP，WPA，WPA2，EAP-FAST，EAP-LEAP和其他途径都有许多可用的攻击。攻击者应熟悉各种加密协议和标准，并能够有效地测试实施控制的实施。
攻击用户
利用恶意接入点来攻击受害者通常是一种有益且可行的攻击方法。在无线评估期间，应该利用恶意接入点吸引受害者以利用漏洞利用或窃取敏感信息。有几种常用技术可供使用，但最常见的是攻击者会设置一个具有相同名称或诱人名称的无线接入点，以便受害者进行连接。
示例攻击途径
在任何情况下，攻击都应该基于参与范围内的场景。以下是根据场景考虑的几种攻击途径的列表，但绝不是一个全面的列表。
Web应用程序攻击社交工程物理攻击途径基于内存的漏洞利用（即缓冲区/堆溢出，内存损坏，释放后使用）。中间VLAN中的人跳跃USB /闪存驱动器部署逆向工程零日角攻击用户加密破解图形处理单元（GPU）破解流量分析火线路由协议网络钓鱼与Pretexting员工假冒
同样，这些示例仅是基于您为组织执行的方案的基本攻击途径。渗透测试的价值来自于创造力以及识别暴露并以精确方式利用它们的能力。
总体目标
在与客户的交互前交互阶段，应该已经传达了对渗透测试的总体目标的明确定义。在开发阶段，最大的挑战是确定在没有检测到的情况下进入组织的最小阻力路径，并对组织产生收入的能力产生最大影响。
通过适当地执行前面的阶段，应该相对理解清楚地了解组织如何运作和赚钱。从开发阶段到后开发阶段，攻击媒介应该完全依赖于规避安全控制的任务，以便通过针对组织的针对性攻击来表示组织如何遭受重大损失。
