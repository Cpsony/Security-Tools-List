http://www.pentest-standard.org/index.php/Intelligence_Gathering

1 总则
1.1 背景概念
1.1.1 1级信息收集
1.1.2 二级信息收集
1.1.3 3级信息收集
2 情报收集
2.1 它是什么
2.2 为什么这样做
2.3 什么不是
3 目标选择
3.1 目标的识别和命名
3.2 考虑任何参与规则限制
3.3 考虑测试的时间长度
3.4 考虑测试的最终目标
4 OSINT
4.1 公司
4.1.1 物理
4.1.1.1 地点（L1）
4.1.1.2 普遍性（L1）
4.1.1.3 关系（L1）
4.1.2 逻辑
4.1.3 组织结构图（L1）
4.1.4 电子
4.1.4.1 文档元数据（L1 / L2）
4.1.4.2 营销传播（L1 / L2）
4.1.5 基础设施资产
4.1.5.1 拥有的网络块（L1）
4.1.5.2 电子邮件地址（L1）
4.1.5.3 外部基础设施配置文件（L1）
4.1.5.4 使用的技术（L1 / L2）
4.1.5.5 购买协议（L1 / L2 / L3）
4.1.5.6 远程访问（L1 / L2）
4.1.5.7 应用程序使用（L1 / L2）
4.1.5.8 防御技术（L1 / L2 / L3）
4.1.5.8.1 被动指纹识别
4.1.5.8.2 主动指纹识别
4.1.5.9 人的能力（L1 / L2 / L3）
4.1.6 财务
4.1.6.1 报告（L1 / L2）
4.1.6.2 市场分析（L1 / L2 / L3）
4.1.6.2.1 贸易资本
4.1.6.2.2 价值历史
4.1.6.2.3 EDGAR（SEC）
4.2 个人
4.2.1 员工
4.2.1.1 历史
4.2.1.2 社交网络（SocNet）简介
4.2.1.3 Internet Presence
4.2.1.4 物理位置
4.2.1.5 移动足迹
4.2.1.6 “付款”信息
5 隐蔽聚会
5.1 公司
5.1.1现场 采集
5.1.2 非现场采集
5.2 人体模型
5.2.1 结果
6 足迹
6.1 外部足迹
6.1.1 识别客户外部范围
6.1.2 被动侦察
6.1.2.1 WHOIS查询
6.1.2.2 BGP查看眼镜
6.1.3 主动足迹
6.1.3.1 端口扫描
6.1.3.2 横幅抓取
6.1.3.3 SNMP扫描
6.1.3.4 区域转移
6.1.3.5 SMTP反弹
6.1.3.6 DNS发现
6.1.3.7 正向/反向DNS
6.1.3.8 DNS Bruteforce
6.1.3.9 Web应用程序发现
6.1.3.10 虚拟主机检测和枚举
6.1.4 建立外部目标清单
6.1.4.1 映射版本
6.1.4.2 识别补丁级别
6.1.4.3 寻找弱Web应用程序
6.1.4.4 确定锁定阈值
6.2 内部足迹
6.2.1 被动侦察
6.2.2 识别客户内部范围
6.2.3 主动侦察
7 确定保护机制
7.1 基于网络的保护
7.2 基于主机的保护
7.3 应用程序级别保护
7.4 存储保护
7.5 用户保护
一般
本节定义渗透测试的智能收集活动。本文件的目的是提供专门为测试者对目标（通常是公司，军队或相关人员）进行侦察而设计的标准。该文件详细介绍了测试侦察的思维过程和目标，如果使用得当，可以帮助读者制定一个攻击目标的高度战略性计划。

背景概念
级别是本文档和整个PTES的重要概念。这是一种用于测试的成熟模型。定义级别使我们能够澄清某些现实约束中的预期输出和活动，例如时间，精力，信息访问等。

智能收集级别目前分为三类，每个类别都有一个典型的例子。这些应该指导下面文档中添加技术。例如，在更高级的情况下，诸如创建Facebook简档和分析目标的社交网络之类的密集活动是适当的，并且应该用适当的级别标记。有关示例，请参阅下面的思维导图。

1级信息收集
（想一想：合规驱动）主要是点击按钮信息收集过程。这种级别的信息几乎可以通过自动化工具获得。至少可以说你为PT做过IG。

Acme Corporation必须符合PCI / FISMA / HIPAA。第1级信息收集工作应该适合满足合规性要求。

2级信息收集
（想想：最佳实践）这个级别可以使用1级自动化工具和一些手动分析来创建。充分了解业务，包括物理位置，业务关系，组织结构图等信息。

Widgets Inc必须符合PCI，但对其长期安全策略感兴趣，并且正在收购几家较小的小部件制造商。2级信息收集工作应该适合满足他们的需求。

3级信息收集
（想想：国家赞助）更先进的pentest，Redteam，全范围。1级和2级的所有信息以及大量的手动分析。想想在SocNet上培养关系，重度分析，深刻理解业务关系，很可能需要花费大量时间来完成收集和关联。

一支陆军红队的任务是分析和攻击陆军在国外的一部分网络，以发现可被外国人利用的弱点。在这种情况下，第3级信息收集工作是适当的。

情报收集
这是什么
情报收集正在对目标进行侦察，以便在漏洞评估和开发阶段穿透目标时收集尽可能多的信息。您可以在此阶段收集的信息越多，您将来可以使用的攻击媒介就越多。

开源智能（OSINT）是一种情报收集管理形式，涉及从公共可用来源查找，选择和获取信息，并对其进行分析以产生可操作的情报。[1]

为什么这样做
我们执行开源智能收集以确定组织中的各种入口点。这些入口点可以是物理的，电子的和/或人的。许多公司没有考虑他们在公共场合放置的关于他们自己的信息，以及如何由坚定的攻击者使用这些信息。最重要的是，许多员工没有考虑他们在公共场合发布的信息，以及如何利用这些信息来攻击他们或他们的雇主。

什么不是
OSINT可能不准确或不及时。信息源可能被故意/意外地操纵以反映错误数据，信息可能随着时间的推移而变得过时，或者仅仅是不完整的。

它不包括垃圾箱潜水或任何从公司内部发现的物理物品中检索公司信息的方法。

目标选择
目标的识别和命名
在接近目标组织时，了解公司可能拥有多个不同的顶级域名（TDL）和辅助业务非常重要。虽然应该在范围界定阶段发现这些信息，但确定其他服务器域和公司可能不属于参与前阶段讨论的初始范围并不是那么不寻常。例如，公司可能具有.com的TDL。但是，他们也可能有.net .co和.xxx。这些可能需要成为修订范围的一部分，或者可能是不受限制的。无论哪种方式，都需要在测试开始之前与客户一起清除。对于一家公司而言，在其下面拥有多家子公司也并非少见。例如，通用电气和宝洁公司拥有大量规模较小的公司。

考虑任何参与规则限制
此时，最好查看“参与规则”。这些在测试中被遗忘是很常见的。有时候，作为测试人员，我们会发现我们发现的内容和攻击的可能性，我们忘记了我们可以攻击哪些IP地址，域和网络。始终，参考参与的规则，以保持您的测试重点。从legel的角度来看，这不仅是重要的，从范围蠕变的角度来看也很重要。每当你从测试的核心目标中偏离时，你就会花费时间。从长远来看，这会花费你公司的钱。

考虑测试的时间长度
总测试的时间量将直接影响可以完成的情报收集量。有些测试的总时间是两到三个月。在这些项目中，测试公司会花费大量时间研究每个核心业务部门和公司的个人。然而，对于较短的水晶盒式测试，目标可能更具战术性。例如，测试特定的Web应用程序可能不需要您研究公司CEO的财务记录。

考虑测试的最终目标
每项测试都有一个最终目标 - 组织认为关键的特定资产或流程。考虑到最终结果，情报收集阶段应确保包括最终目标周围的所有二级和三级元素。无论是支持技术，第三方，相关人员等......确保关键资产保持重点确保较少的相关情报要素被排除优先次序并进行分类，以便不干预分析过程。

OSINT
开源智能（OSINT）有三种形式; 被动，半被动和主动。

被动信息收集：被动信息收集通常仅在非常明确要求目标永远不会检测到信息收集活动时才有用。这种类型的分析在技术上很难执行，因为我们永远不会从我们的主机或“匿名”主机或Internet上的服务向目标组织发送任何流量。这意味着我们只能使用和收集存档或存储的信息。因此，这些信息可能已过时或不正确，因为我们仅限于从第三方收集的结果。

半被动信息收集：半被动信息收集的目标是使用看起来像正常的互联网流量和行为的方法来分析目标。我们只查询已发布的名称服务器以获取信息，我们没有执行深入的反向查找或强制DNS请求，我们不会搜索“未发布的”服务器或目录。我们没有运行网络级端口扫描程序或爬虫程序，我们只查看已发布文档和文件中的元数据; 不积极寻求隐藏的内容。这里的关键是不要引起人们对我们活动的关注。验尸后，目标可能会返回并发现侦察活动，但他们不应该将活动归咎于任何人。

主动信息收集：目标和可疑或恶意行为应检测主动信息收集。在此阶段，我们正在积极地映射网络基础设施（想想全端口扫描nmap -p1-65535），主动枚举和/或漏洞扫描开放服务，我们正在积极搜索未发布的目录，文件和服务器。大多数此类活动属于您标准测试的典型“侦察”或“扫描”活动。

企业
物理
地点（L1）
按位置列出完整地址，所有权，相关记录（城市，税收，法律等），所有物理安全措施的完整列表（摄像机位置，传感器，围栏，警卫岗位，入口控制，大门，识别类型） ，供应商的入口，基于IP块/地理定位服务的物理位置等...对于主机/ NOC：主机和网络的完整CIDR表示法，所有相关资产的完整DNS列表，AS的完整映射，对等路径，CDN供应，网络所有者（whois数据），电子邮件记录（MX +邮件地址结构）

所有者（L1 / L2）
土地/税务记录（L1 / L2）
共享/个人（L1 / L2）
时区（L1 / L2）
主持人/ NOC
普遍性（L1）
目标组织具有多个单独的物理位置并不罕见。例如，银行将设有中央办公室，但它们也将拥有众多远程分支机构。虽然物理和技术安全性在中心位置可能非常好，但远程位置通常具有较差的安全控制。

关系（L1）
业务合作伙伴，海关，供应商，分析通过公司网页，租赁公司等公开分享。这些信息可用于更好地了解业务或组织项目。例如，哪些产品和服务对目标组织至关重要？

此外，此信息还可用于创建成功的社交工程方案。

关系（L2 / L3）
手动分析以审查第1级的信息，并深入挖掘可能的关系。
共用办公空间（L2 / L3）
共享基础设施（L2 / L3）
租赁/租赁设备（L2 / L3）
合乎逻辑
为合作伙伴，客户和竞争对手积累的信息：每一个都包含业务名称，业务地址，关系类型，基本财务信息，基本主机/网络信息的完整列表。

业务合作伙伴（L1 / L2 / L3）
Target的广告业务合作伙伴。有时在主要www上做广告。
商业客户（L1 / L2 / L3）
Target的广告业务客户。有时在主要www上做广告。
竞争对手（L1 / L2 / L3）
谁是目标的竞争对手。这可能很简单，福特与雪佛兰，或者可能需要更多的分析。
触摸图（L1）
触摸图（人与人之间社会关系的直观表示）将有助于绘制组织中人员之间可能的交互，以及如何从外部访问它们（当触摸图包括外部社区并且创建的深度级别高于2）。
基本接触图应该反映从目前为止收集的信息中得出的组织结构，并且图表的进一步扩展应该基于它（因为它通常代表更好地关注组织资产，并使可能的方法向量清晰。
Hoovers profile（L1 / L2）
什么：半开源情报资源（通常是付费订阅）。这些来源专门收集有关公司的业务相关信息，并提供关于业务的“标准化”观点。
原因：信息包括物理位置，竞争格局，关键人员，财务信息和其他业务相关数据（取决于来源）。这可用于创建更准确的目标配置文件，并识别可用于测试的其他人员和第三方。
方法：使用公司名称在网站上进行简单搜索，可以提供公司的完整个人资料以及公司提供的所有信息。建议使用几个来源以交叉引用它们并确保获得最新信息。（付费服务）。
产品系列（L2 / L3）
Target的产品可能需要额外的分析，如果目标确实提供服务，这可能需要进一步分析。
市场垂直（L1）
目标所在的行业，即金融，国防，农业，政府等
营销账户（L2 / L3）
营销活动可以提供有关目标营销策略的丰富信息
评估目标社交角色的所有社交媒体网络
评估目标过去的*营销活动
会议（L2 / L3）
会议纪要发布？
会议向公众开放？
重要的公司日期（L1 / L2 / L3）
董事会会议
假期
纪念日
产品/服务推出
职位空缺（L1 / L2）
通过查看组织中的职位空缺列表（通常位于其网站的“职业”部分），您可以确定组织内使用的技术类型。一个例子是，如果组织有高级Solaris系统管理员的职位空缺，那么该组织使用Solaris系统就很明显了。职位名称的其他职位可能不那么明显，但是一个开放的初级网络管理员职位可能会说“CCNA首选”或“JNCIA首选”的效果，它告诉您他们要么使用Cisco或Juniper技术。
慈善机构（L1 / L2 / L3）
目标组织的执行成员与慈善组织相关联是很常见的。此信息可用于为目标管理人员开发可靠的社交工程方案。
RFP，RFQ和其他公开招标信息（L1 / L2）
RFP和RFQ通常会显示有关公司使用的系统类型的大量信息，甚至可能与其基础架构存在差距或问题。
找出当前中标者是谁可以揭示正在使用的系统类型或公司资源可能在非现场托管的位置。
法庭记录（L2 / L3）
法庭记录通常是免费的，有时是收费的。
诉讼内容可以揭示过去投诉人的信息，包括但不限于以前的员工诉讼
当前和过去雇员的犯罪记录可以提供社会工程努力的目标列表
政治捐款（L2 / L3）
制定政治捐赠或其他经济利益非常重要，以便确定可能不具有明显权力地位但具有既得利益（或其中存在既得利益）的关键人物。
政治捐赠的映射将根据信息自由在各国之间发生变化，但通常可以使用其中的数据追溯其他国家的捐赠情况。
专业许可证或注册管理机构（L2 / L3）
收集目标列表专业许可证和注册管理机构不仅可以深入了解公司的运营方式，还可以了解他们为维护这些许可证而遵循的准则和法规。一个典型的例子是公司ISO标准认证可以表明公司遵循既定的指导方针和流程。对于测试人员来说，了解这些过程以及它们如何影响对组织执行的测试非常重要。
公司通常会在其网站上列出这些详细信息作为荣誉徽章。在其他情况下，可能需要搜索给定垂直的注册表，以查看组织是否是成员。可用信息非常依赖于垂直市场以及公司的地理位置。还应该指出的是，国际公司可能获得不同的许可，并被要求在依赖国家的不同标准或法律机构注册。
组织结构图（L1）
职位识别
组织中的重要人物
个人专门针对目标
交易
映射组织内的变化（促销，横向移动）
关联公司
映射与业务关联的联盟组织

电子
文档元数据（L1 / L2）
这是什么？元数据或元内容提供有关范围内的数据/文档的信息。它可以包含作者/创建者名称，时间和日期，使用/引用的标准，计算机网络中的位置（打印机/文件夹/目录路径/等信息），地理标记等信息。对于图像，其'元数据可以包含颜色，深度，分辨率，相机品牌/类型，甚至包括坐标和位置信息。
你为什么要这样做？元数据很重要，因为它包含有关内部网络，用户名，电子邮件地址，打印机位置等的信息，并将有助于创建该位置的蓝图。它还包含有关用于创建相应文档的软件的信息。这可以使攻击者能够利用网络和用户的内部知识创建配置文件和/或执行目标攻击。
你会怎么做？有一些工具可用于从文件（pdf / word / image）中提取元数据，如FOCA（基于GUI），metagoofil（基于python），meta-extractor，exiftool（基于perl）。这些工具能够以HTML，XML，GUI，JSON等不同格式提取和显示结果。这些工具的输入主要是从“客户”的公开存在下载的文档，然后进行分析以了解更多信息。 。而FOCA可帮助您搜索文档，通过其GUI界面下载和分析所有文档。
营销传播（L1 / L2）
过去的营销活动为可能仍然可以访问的可能已退休的项目提供信息。
当前的营销传播包含设计组件（颜色，字体，图形等），这些组件大部分也在内部使用。
其他联系信息包括外部营销组织。
基础设施资产
拥有的网络块（L1）
组织拥有的网络块可以通过执行whois搜索被动获取。DNSStuff.com是获取此类信息的一站式商店。
IP地址的开源搜索可以生成有关目标基础结构类型的信息。管理员经常在各种支持站点的帮助请求的上下文中发布IP地址信息。
电子邮件地址（L1）
电子邮件地址提供了有效用户名和域结构的潜在列表
可以从包括组织网站在内的多个来源收集电子邮件地址。
外部基础设施简介（L1）
目标的外部基础架构配置文件可以提供有关内部使用的技术的大量信息。
这些信息可以被动地和主动地从多个来源收集。
该配置文件应用于组装针对外部基础架构的攻击场景。
使用的技术（L1 / L2）
OSINT搜索支持论坛，邮件列表和其他资源可以收集目标使用的技术信息
对已识别的信息技术组织使用社会工程
对产品供应商使用社会工程
购买协议（L1 / L2 / L3）
购买协议包含有关目标的硬件，软件，许可证和其他有形资产的信息。
远程访问（L1 / L2）
获取有关员工和/或客户端如何连接到目标以进行远程访问的信息提供了潜在的入口点。
通常，目标主页上可以链接到远程访问门户
如何文档显示连接远程用户的应用程序/过程
应用用途（L1 / L2）
收集目标组织使用的已知应用程序列表。这通常可以通过从可公开访问的文件中提取元数据来实现（如前所述）

防御技术（L1 / L2 / L3）
使用中的指纹识别防御技术可以根据使用的防御以多种方式实现。

被动指纹识别
搜索论坛和可公开访问的信息，目标组织的技术人员可能正在讨论问题或寻求有关所用技术的帮助
搜索目标组织以及流行技术供应商的营销信息
使用Tin-eye（或其他图像匹配工具）搜索目标组织徽标，以查看它是否列在供应商参考页面或营销材料上
主动指纹识别
将适当的探测包发送到面向公众的系统，以测试阻塞模式。存在用于特定WAF类型的指纹识别的若干工具。
来自目标网站和电子邮件的响应中的标题信息通常不仅显示正在使用的系统的信息，还显示启用的特定保护机制（例如，电子邮件网关防病毒扫描程序）
人的能力（L1 / L2 / L3）
发现目标组织的防御性能力可能很困难。有几个关键信息可以帮助判断目标组织的安全性。

检查公司范围内的CERT / CSIRT / PSRT团队是否存在
检查广告作业以查看列出安全位置的频率
检查广告的作业，看是否将安全性列为非安全作业的要求（例如开发人员）
检查外包协议，看看目标的安全性是部分外包还是全部外包
检查可能在安全社区中活动的公司的特定个人
金融
报告（L1 / L2）
财务报告的目标将在很大程度上取决于组织的位置。报告也可以通过组织总部而不是每个分支机构进行。2008年，美国证券交易委员会发布了在美国采用国际财务报告准则（IFRS）的拟议路线图。

每个国家的IFRS采用 - > http://www.iasplus.com/en/resources/use-of-ifrs

市场分析（L1 / L2 / L3）
从分析师组织（如Gartner，IDC，Forrester，541等）获取市场分析报告。这应包括市场定义，市值，竞争对手以及估值，产品或公司的一般重大变化。
贸易资本
确定组织是在分配任何贸易资本，以及它拥有的总体估值和自由资本的百分比。这将表明该组织对市场波动的敏感程度，以及它是否依赖外部投资作为其估值和现金流的一部分。
价值历史
绘制组织随时间的估值，以确定外部和内部事件之间的相关性，以及它们对估值的影响。
EDGAR（SEC）
它是什么：EDGAR（电子数据收集，分析和检索系统）是美国证券交易委员会（SEC）的数据库，其中包含所有公司（国内和国外）的注册声明，定期报告和其他信息。法律要求谁提交。
为什么这样做：EDGAR数据非常重要，因为除了财务信息之外，EDGAR数据还可以识别公司内部的关键人员，这些人员可能无法从公司的网站或其他公共场所获得。它还包括高管薪酬的声明，主要普通股股东的姓名和地址，针对公司的法律诉讼摘要，经济风险因素以及其他可能有趣的数据。
如何获得：该信息可在美国证券交易委员会的EDGAR网站上获取（http://www.sec.gov/edgar.shtml）。特别感兴趣的报告包括10-K（年度报告）和10-Q（季度报告）。
个人
雇员
历史
法庭记录（L2 / L3）
它是什么：法院记录是与针对感兴趣的个人或组织的刑事和/或民事投诉，诉讼或其他法律行为相关的所有公共记录。
为什么要这样做：法院记录可能会泄露与个别员工或整个公司相关的敏感信息。该信息本身可能是有用的，或者可能是获取其他信息的驱动因素。它也可以在渗透测试中用于社会工程或其他目的。
你将如何做到这一点：现在大部分信息都可以通过公共法院网站和记录数据库在互联网上获得。可通过LEXIS / NEXIS等付费服务获得一些其他信息。某些信息可通过记录请求或亲自请求获得。
政治捐款（L2 / L3）
它是什么：政治捐赠是个人的个人资金，针对特定的政治候选人，政党或特殊利益组织。
为什么要这样做：有关政治捐款的信息可能会泄露与个人相关的有用信息。这些信息可以用作社交网络分析的一部分，以帮助吸引个人和政治家，政治候选人或其他政治组织之间的联系。它也可以在渗透测试中用于社会工程或其他目的。
你将如何做到这一点：现在大部分信息都可以通过公共网站（即http://www.opensecrets.org/）在互联网上获取，这些网站跟踪个人的政治捐款。根据特定州的法律，通常需要记录超过一定数额的捐款。
专业许可证或注册管理机构（L2 / L3）
它是什么：专业许可证或注册管理机构是包含成员列表和其他相关信息的信息库，这些信息适用于已获得特定许可证或某个社区内特定联属关系的个人。
为什么要这样做：有关专业许可的信息可能会泄露与个人相关的有用信息。这些信息可用于验证个人的可信度（他们是否真的拥有他们声称的特定认证），或作为社交网络分析的一部分，帮助在个人和其他组织之间建立联系。它也可以在渗透测试中用于社会工程或其他目的。
你将如何做到这一点：现在大部分信息都可以通过公共网站在互联网上获得。通常，每个组织都维护自己的信息注册表，这些信息可能在线提供，或者可能需要额外的步骤来收集。
社交网络（SocNet）简介
元数据泄漏（L2 / L3）
通过照片元数据识别位置
音调（L2 / L3）
预期可交付成果：主观识别通信中使用的语气 - 积极，被动，吸引人，销售，赞美，溺爱，居高临下，傲慢，精英，失败者，领导者，追随者，模仿等......
频率（L2 / L3）
预期可交付成果：确定出版物的频率（每小时/每天/每周一次等）。另外 - 通信易于发生的时间/周。
位置感知（L2 / L3）
通过与应用程序和社交网络的直接交互，或通过照片元数据的被动参与，映射来自各种来源的人员的位置历史记录。
Bing地图应用
四方
谷歌纵横
喊叫
Gowalla的
社交媒体存在（L1 / L2 / L3）
验证目标的社交媒体帐户/状态（L1）。并提供详细分析（L2 / L3）
互联网存在
电邮地址（L1）
这是什么？电子邮件地址是用户的公共邮箱ID。
你为什么要这样做？电子邮件地址获取或搜索非常重要，因为它有多种用途 - 提供了一种可能的用户ID格式，以后可以强制进行访问，但更重要的是它有助于发送目标垃圾邮件甚至自动机器人。这些垃圾邮件可以包含漏洞利用，恶意软件等，并且可以使用特定内容特别是针对用户来解决。
你会怎么做？可以从各种网站，组，博客，论坛，社交网络门户等搜索和提取电子邮件地址。这些电子邮件地址也可从各种技术支持网站获得。有收获和蜘蛛工具来执行搜索映射到某个域的电子邮件地址（如果需要）。
个人手柄/昵称（L1）
个人域名注册（L1 / L2）
分配的静态IP /网络块（L1 / L2）
物理位置
物理位置
你能得出目标的物理位置吗？
移动足迹
电话号码（L1 / L2 / L3）
设备类型（L1 / L2 / L3）
使用（L1 / L2 / L3）
已安装的应用程序（L1 / L2 / L3）
所有者/管理员（L1 / L2 / L3）

“付费”信息
背景调查
付费链接
LEXIS / NEXIS
隐蔽聚会
企业
现场采集
为现场采集选择特定位置，然后随着时间的推移进行侦察（通常至少2-3天以确保模式）。在进行现场情报收集时，需要遵循以下要素：

物理安全检查
无线扫描/射频扫描
员工行为培训考察
无障碍/邻近设施（共用空间）
垃圾箱潜水
使用的设备类型
场外聚会
识别场外位置及其与组织的重要性/关系。这些都是逻辑和物理位置，如下所示：

数据中心位置
网络配置/提供商
HUMINT
人类智能补充了资产上更被动的聚集，因为它提供了其他方式无法获得的信息，并为情报图片添加了更多“个人”视角（感受，历史，关键人物之间的关系，“氛围”等） ...）

获得人类智能的方法总是涉及直接的互动 - 无论是身体上的还是口头上的。收集应在假定的身份下进行，这种身份将专门用于实现有关资产的最佳信息曝光和合作。

此外，可以通过仅利用观察来执行对更敏感目标的情报收集 - 再次，在物理上在现场，或通过电子/远程手段（CCTV，网络摄像头等......）。这通常是为了建立行为模式（例如访问频率，着装要求，访问路径，可提供额外访问的关键位置，例如咖啡店）。

结果
主要员工
合作伙伴/供应商
社会工程学
足迹
它是什么：外部信息收集，也称为足迹，是一个信息收集阶段，包括与目标的交互，以便从组织外部的角度获取信息。

原因：通过与目标互动可以收集大量信息。通过探测服务或设备，您通常可以创建可以进行指纹识别的场景，或者甚至更简单地，可以获取可识别设备的横幅。此步骤对于收集有关目标的更多信息是必要的。在此部分之后，您的目标是优先级目标列表。

外部足迹
识别客户外部范围
在渗透测试期间收集情报的主要目标之一是确定将在范围内的主机。有许多技术可用于识别系统，包括使用反向DNS查找，DNS布局，域和范围上的WHOIS搜索。这些技术和其他技术记录如下。

被动侦察
WHOIS查询
对于外部足迹，我们首先需要确定哪一个WHOIS服务器包含我们所追求的信息。鉴于我们应该知道目标域的TLD，我们只需找到目标域注册的注册服务商。

WHOIS信息基于树层次结构。ICANN（IANA）是所有TLD的权威注册机构，是所有手动WHOIS查询的良好起点。

ICANN - http://www.icann.org
IANA - http://www.iana.com
NRO - http://www.nro.net
AFRINIC - http://www.afrinic.net
APNIC - http://www.apnic.net
ARIN - http://ws.arin.net
LACNIC - http://www.lacnic.net
RIPE - http://www.ripe.net
一旦查询了相应的注册商，我们就可以获得注册人信息。有许多网站提供WHOIS信息; 但是，为了准确记录文档，您只需使用相应的注册器。

InterNIC - http://www.internic.net/ http://www.internic.net ]
通常，针对ARIN的简单whois会将您转介给正确的注册商。

BGP看眼镜
可以识别参与边界网关协议（BGP）的网络的自治系统编号（ASN）。由于BGP路由路径在全世界广告，我们可以通过使用BGP4和BGP6查找玻璃来找到它们。

BGP4 - http://www.bgp4.as/looking-glasses
BPG6 - http://lg.he.net/
主动足迹
端口扫描
端口扫描技术将根据测试可用的时间量和隐身需求而有所不同。如果系统知之甚少，则可以使用快速ping扫描来识别系统。此外，应运行没有ping验证的快速扫描（nmap中的-PN）以检测最常见的可用端口。完成后，可以运行更全面的扫描。有些测试人员只检查打开的TCP端口，确保也检查UDP。该http://nmap.org/nmap_doc.html文档的详细信息端口扫描类型。Nmap（“网络映射器”）是网络审计/扫描的事实标准。Nmap在Linux和Windows上运行。

您可以在PTES技术指南中找到有关将Nmap用于此目的的更多信息

Nmap提供了许多选项。由于本节涉及端口扫描，因此我们将重点介绍执行此任务所需的命令。重要的是要注意所使用的命令主要取决于被扫描的主机的时间和数量。您执行此任务所需的主机越多或时间越少，我们查询主机的次数就越少。随着我们继续讨论各种选择，这将变得明显。

还应测试IPv6。

横幅掠夺
Banner Grabbing是一种枚举技术，用于收集有关网络上计算机系统和运行其开放端口的服务的信息。横幅抓取用于识别网络目标主机正在运行的应用程序和操作系统的版本。

横幅抓取通常在超文本传输​​协议（HTTP），文件传输协议（FTP）和简单邮件传输协议（SMTP）上执行; 端口80,21和25分别。常用于执行横幅抓取的工具是Telnet，nmap和Netcat。

SNMP扫描
SNMP扫描也会执行，因为它们提供了大量有关特定系统的信息。SNMP协议是一种无状态的，面向数据报的协议。遗憾的是，SNMP服务器不响应具有无效社区字符串的请求，并且基础UDP协议无法可靠地报告关闭的UDP端口。这意味着来自探测到的IP地址的“无响应”可能意味着以下任何一种情况：

机器无法到达
SNMP服务器未运行
社区字符串无效
响应数据报尚未到达
区域转移
DNS区域传输（也称为AXFR）是一种DNS事务。它是一种机制，旨在通过一组DNS服务器复制包含DNS数据的数据库。区域转移有两种形式，完整（AXFR）和增量（IXFR）。有许多工具可用于测试执行DNS区域传输的能力。通常用于执行区域传输的工具是host，dig和nmap。

SMTP反弹
SMTP退回，也称为未送达报告/收据（NDR），（失败）传递状态通知（DSN）消息，未送达通知（NDN）或仅仅是退回，是来自的自动电子邮件消息邮件系统通知发件人有关传递问题的另一条消息。这可用于帮助攻击者指纹SMTP服务器，因为SMTP服务器信息（包括软件和版本）可能包含在退回邮件中。

这可以通过在目标域中创建虚假地址来完成。例如，asDFADSF_garbage_address@target.com可用于测试target.com。Gmail提供对标题的完全访问权限，使其成为测试人员的简单选择。

DNS发现
可以通过查看域的权威名称服务器的WHOIS记录来执行DNS发现。此外，应检查主域名的变体，并检查网站是否有可能受目标控制的其他域的引用。

正向/反向DNS
反向DNS可用于获取组织内使用的有效服务器名称。有一点需要注意，它必须有一个PTR（反向）DNS记录才能从提供的IP地址解析名称。如果确实解决了，则返回结果。这通常通过使用各种IP地址测试服务器来执行，以查看它是否返回任何结果。

DNS Bruteforce
在识别与客户端域关联的所有信息之后，现在是时候开始查询DNS了。由于DNS用于将IP地址映射到主机名，反之亦然，我们希望查看它是否是不安全配置。我们将寻求使用DNS来揭示有关客户端的其他信息。涉及DNS的最严重的错误配置之一是允许Internet用户执行DNS区域传输。我们可以使用几种工具来枚举DNS，以便不仅检查执行区域传输的能力，还可以发现不常见的其他主机名。

Web应用程序发现
在渗透测试期间识别弱Web应用程序可能是一项特别富有成效的活动。要查找的内容包括错误配置的OTS应用程序，具有插件功能的OTS应用程序（插件通常包含比基本应用程序更易受攻击的代码）以及自定义应用程序。这里可以使用诸如WAFP之类的Web应用程序指纹识别器来产生很好的效果。

虚拟主机检测和枚举
Web服务器通常托管多个“虚拟”主机，以整合单个服务器上的功能。如果多个服务器指向相同的DNS地址，则它们可以托管在同一服务器上。MSN搜索等工具可用于将IP地址映射到一组虚拟主机。

建立外部目标清单
完成上述活动后，应编制用户，电子邮件，域，应用程序，主机和服务的列表。

映射版本
版本检查是识别应用程序信息的快捷方式。在某种程度上，可以使用nmap对服务版本进行指纹识别，并且通常可以通过查看任意页面的来源来收集Web应用程序的版本。

识别补丁级别
要在内部识别服务的补丁级别，请考虑使用将询问系统版本之间差异的软件。如果客户已经默认，凭证可以用于渗透测试的这个阶段。漏洞扫描程序在没有凭据的情况下远程识别补丁级别特别有效。

寻找弱Web应用程序
在渗透测试期间识别弱Web应用程序可能是一项特别富有成效的活动。要查找的内容包括错误配置的OTS应用程序，具有插件功能的OTS应用程序（插件通常包含比基本应用程序更易受攻击的代码）以及自定义应用程序。这里可以使用诸如WAFP之类的Web应用程序指纹识别器来产生很好的效果。


确定锁定阈值
识别身份验证服务的锁定阈值将允许您确保您的暴力攻击在测试期间不会故意锁定有效用户。识别环境中的所有不同身份验证服务，并测试单个无害的帐户以进行锁定。通常，有效帐户的5到10次尝试足以确定服务是否会锁定用户。

内部足迹
被动侦察
如果测试人员可以访问内部网络，则数据包嗅探可以提供大量信息。使用像p0f中实现的技术来识别系统。

识别客户内部范围
执行内部测试时，首先枚举您的本地子网，并且您可以通过稍微修改地址来从那里推断到其他子网。另外，看一下内部主机的路由表可能特别有说服力。以下是可以使用的许多技术。

DHCP服务器不仅可以是本地信息的潜在来源，还可以是远程IP范围和重要主机的详细信息。大多数DHCP服务器将提供本地IP网关地址以及DNS和WINS服务器的地址。在基于Windows的网络中，DNS服务器往往是Active Directory域控制器，因此也是感兴趣的目标。

积极侦察
内部主动侦察应包含外部主动侦察的所有要素，此外还应侧重于内部网功能，例如：

目录服务（Active Directory，Novell，Sun等...）
提供业务功能的Intranet站点
企业应用程序（ERP，CRM，会计等......）
识别敏感网段（会计，研发，营销等......）
访问映射到生产网络（数据中心）
VoIP基础设施
身份验证配置（kerberos，cookie令牌等）
代理和互联网访问管理

确定保护机制
应根据相关地点/组/人员确定以下要素并进行映射。这将使得在执行实际攻击时能够正确应用漏洞研究和利用 - 从而最大化攻击效率，并最小化检测率。

基于网络的保护
“简单”数据包过滤器
流量整形设备
DLP系统
加密/隧道

基于主机的保护
堆栈/堆保护
应用白名单
AV /过滤/行为分析
DLP系统

应用程序级别保护
识别应用程序保护
编码选项
潜在的绕道途径
白名单页面

存储保护
HBA - 主机级别
LUN Masking
存储控制器
iSCSI CHAP密钥

用户保护
AV /垃圾邮件过滤软件
限制可利用性的SW配置可以被认为是反垃圾邮件/反AV
